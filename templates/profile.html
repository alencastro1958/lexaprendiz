<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Meu Perfil - LexAprendiz</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container mt-5">
    <h2 class="text-center mb-4">ðŸ‘¤ Meu Perfil</h2>
    <form method="POST" class="card p-4 shadow-sm">
      <div class="mb-3">
        <label class="form-label">Nome completo</label>
        <input type="text" name="name" class="form-control" value="{{ current_user.name or '' }}" required>
      </div>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">CPF</label>
          <input type="text" name="cpf" class="form-control" value="{{ current_user.cpf or '' }}" minlength="11" maxlength="14" required>
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">Cidade</label>
          <input type="text" name="city" class="form-control" value="{{ current_user.city or '' }}" required>
        </div>
        <div class="col-md-2 mb-3">
          <label class="form-label">UF</label>
          <input type="text" name="state" class="form-control" maxlength="2" value="{{ current_user.state or '' }}" required>
        </div>
      </div>
      <div class="row">
        <div class="col-md-3 mb-3">
          <label class="form-label">CEP</label>
          <input type="text" name="cep" id="cep" class="form-control" value="{{ current_user.cep or '' }}" minlength="8" maxlength="9">
        </div>
        <div class="col-md-9 mb-3">
          <label class="form-label">EndereÃ§o</label>
          <input type="text" name="address" id="address" class="form-control" value="{{ current_user.address or '' }}" placeholder="Rua/Av, etc.">
        </div>
      </div>
      <div class="row">
        <div class="col-md-3 mb-3">
          <label class="form-label">NÃºmero</label>
          <input type="text" name="number" id="number" class="form-control" value="{{ current_user.number or '' }}">
        </div>
        <div class="col-md-5 mb-3">
          <label class="form-label">Bairro</label>
          <input type="text" name="neighborhood" id="neighborhood" class="form-control" value="{{ current_user.neighborhood or '' }}">
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">Complemento</label>
          <input type="text" name="complement" id="complement" class="form-control" value="{{ current_user.complement or '' }}" placeholder="Opcional">
        </div>
      </div>
      <button type="submit" class="btn btn-primary">Salvar</button>
      <a href="/" class="btn btn-secondary ms-2">Voltar</a>
    </form>
  </div>
<script>
document.getElementById('cep')?.addEventListener('blur', async function() {
  const raw = this.value.replace(/\D/g, '');
  if (raw.length !== 8) return;
  try {
    const r = await fetch(`https://viacep.com.br/ws/${raw}/json/`);
    const data = await r.json();
    if (data.erro) return;
    document.getElementById('address').value = `${data.logradouro}`.trim();
    document.querySelector('input[name="city"]').value = `${data.localidade}`.trim();
    document.querySelector('input[name="state"]').value = `${data.uf}`.trim();
    document.getElementById('neighborhood').value = `${data.bairro}`.trim();
  } catch (e) { /* silencioso */ }
});
</script>
</body>
</html>
